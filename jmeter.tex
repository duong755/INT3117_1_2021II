\documentclass[10pt]{report}
\usepackage[a4paper,top=2cm,right=2cm,bottom=2cm,left=2cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[utf8]{vietnam}
\usepackage{multirow}
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{chngcntr}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{xurl}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{placeins}
\usepackage{enumitem}
\usepackage{amsmath,amsfonts,amsthm,amssymb}

\setlength{\headheight}{17.64015pt}
\renewcommand{\familydefault}{\sfdefault}

\pagestyle{fancy}
\setlength{\headheight}{16pt}
\lhead{}
\rhead{\leftmark}
\lfoot{}
\cfoot{\thepage}
\rfoot{}

\titleformat{\chapter}[display]{\flushright\bf\huge\color{red}}{\chaptertitlename\ \thechapter}{10pt}{}
\titleformat{\section}{\bf\Large\color{red}}{\thesection}{10pt}{}
\titleformat{\subsection}{\bf\large\color{red}}{\thesubsection}{10pt}{}
\titleformat{\subsubsection}{\bf\normalsize\color{red}}{\thesubsubsection}{10pt}{}

\newcommand{\apachejmeter}{\textbf{Apache JMeter}}
\newcommand{\jmeter}{\textbf{JMeter}}
\newcommand{\apache}{\textbf{Apache}}
\newcommand{\java}{\textbf{Java}}
\newcommand{\jmeterhome}{\texttt{\$JMETER\_HOME}}

\begin{document}

\begin{titlepage}
    \begin{tikzpicture}[remember picture, overlay]
        \draw[double,double distance=5pt,ultra thick] ($(current page.north west) + (2cm,-2cm)$) rectangle ($(current page.south east) + (-2cm,2cm)$);
    \end{tikzpicture}

    \begin{center}
        \vfill
        {\LARGE\bf Kiểm thử và đảm bảo chất lượng phần mềm} \\
        {\Large\bf INT3117 1, học kỳ II năm học 2020$-$2021} \\
        \bigskip
        \bigskip

        \bigskip
        {\Huge\bf Tìm hiểu công cụ Apache JMeter}
        \bigskip

        \bigskip
        \bigskip

        % chktex-file 44
        \begin{tabular}{c|l}
            \multirow{2}{*}{Thành viên nhóm} & Ngô Quang Dương (17020191) \\
            & Nguyễn Phương Hiếu (17020747) \\
        \end{tabular} \\
        \medskip
        {\today}
        \vfill
    \end{center}
\end{titlepage}

\tableofcontents

\chapter{Giới thiệu}

\section{Lịch sử}

\par \jmeter{} là một dự án mã nguồn mở của \apache{}, được viết hoàn toàn bằng \java{}. \jmeter{} cung cấp giao diện đồ họa sử dụng Swing. Mã nguồn của dự án được public trên GitHub:~\url{https://github.com/apache/jmeter}

\par \jmeter{} được sử dụng để kiểm tra hiệu năng của server (web server, FTP server, mail server, \ldots), giả lập lượt truy cập, hiển thị kết quả kiểm tra hiệu năng trên giao diện đồ họa.

\par Người đầu tiên phát triển \jmeter{} là \href{https://www.linkedin.com/in/stefanom}{Stefano Mazzocchi}. Ban đầu, anh tạo ra công cụ này để kiểm tra hiệu năng cho một dự án web server là \textbf{Apache JServ}, dự án mà sau này được thay thế bằng \textbf{Apache Tomcat}. Phiên bản 1.0 của \jmeter{} được đưa ra vào cuối năm 1998. Từ đó đến nay, các tính năng của \jmeter{} liên tục được bổ sung và nâng cao.

\par Ban đầu, \jmeter{} chỉ được thiết kế để kiểm tra hiệu năng của các ứng dụng web. Về sau, \jmeter{} được cung cấp thêm các tính năng khác cho việc kiểm thử chức năng và hiệu năng.

\section{Cài đặt}

\par Ở thời điểm báo cáo này được viết, phiên bản mới nhất của \jmeter{} là 5.4.1. \jmeter{} có thể được tải về dưới một trong hai dạng: \textit{mã nguồn} và \textit{binaries} từ website
\begin{quotation}
  \url{https://jmeter.apache.org/download_jmeter.cgi}
\end{quotation}

\par Phiên bản này yêu cầu máy có \java{} 8+. Nếu chọn cách tải mã nguồn, máy cần được cài thêm Gradle để biên dịch.
\bigskip
\par Các phiên bản trước của \jmeter{} có thể được tải về từ link lưu trữ
\begin{quotation}
  \url{https://archive.apache.org/dist/jmeter/binaries/}
\end{quotation}

\bigskip
\par Đối với lựa chọn tải binaries, sau khi tải về và giải nén, ta có được một cấu trúc thư mục như sau:

\begin{verbatim}
bin/
  - examples/
  - report-template/
  - templates/
docs/
  - api/
  - css/
  - images/
extras/
lib/
  - ext/
  - junit/
licenses/
printable_docs/
  - demos/
  - extending/
  - localising/
  - usermanual/
\end{verbatim}

\par Trong các thư mục trên, cần lưu ý nhất tới \texttt{bin/} và \texttt{lib/}. \textbf{Quy ước trong toàn bộ báo cáo này, \jmeterhome{} là thư mục chứa \texttt{bin/} và \texttt{lib/}}.

\begin{itemize}[itemsep=0pt]
  \item \texttt{bin/} chứa các file thực thi để sử dụng \jmeter{}.
  \item \texttt{lib/}
      \begin{itemize}[itemsep=0pt]
          \item \texttt{./} các file JAR tiện ích.
          \item \texttt{ext/} các plugins cho \jmeter{}.
      \end{itemize}
\end{itemize}

\par Những file JAR của JDBC, JMS (Java Message Service, chẳng hạn như Apache Kafka) và những thư viện mà \jmeter{} cần đều được đặt trong thư mục \texttt{lib/} (không phải thư mục \texttt{lib/ext/}).

\par Để bắt đầu sử dụng \jmeter{}, truy cập thư mục \texttt{bin/} (từ Powershell/Command Prompt nếu sử dụng Windows, từ Terminal nếu sử dụng Linux/Mac), sau đó
\begin{itemize}[itemsep=0pt]
  \item Chạy file \texttt{jmeter.bat} nếu máy sử dụng Windows.
  \item Ngược lại, chạy file \texttt{jmeter}.
\end{itemize}

\par Sau đó, giao diện đồ họa của \jmeter{} hiện lên như sau:

\FloatBarrier{}
\begin{figure}[htp]
  \centering
  \includegraphics[scale=0.33]{jmeter-gui.png}
  \caption{Giao diện đồ họa của \jmeter{}}
\end{figure}
\FloatBarrier{}

\par Có thể có lỗi khi chạy \jmeter{} trên Linux, như việc không tìm thấy một class, chẳng hạn
\begin{quotation}
\texttt{org.GNOME.Accessibility.AtkWrapper}
\end{quotation}

\par Để khắc phục điều này, hãy comment lại các class trong file
\begin{quotation}
\texttt{/etc/java-8-openjdk/accessibility.properties}
\end{quotation}
\par và khởi động \jmeter{} một lần nữa.

\chapter{Các thành phần và cách hoạt động của JMeter}

\section{Test plan}

\par Để thực hiện việc kiểm thử với \jmeter{}, việc đầu tiên cần làm chính là tạo một Test plan.

\par Test plan chính là đơn vị/thành phần lớn nhất mà ta sẽ làm việc cùng khi sử dụng \jmeter{}. Test plan chứa một chuỗi các hành động mà \jmeter{} sẽ thực thi khi chạy test plan đó.

\par Một test plan hoàn chỉnh trong \jmeter{} bao gồm những thành phần sau:
\begin{itemize}[itemsep=0pt]
    \item Thread group.
    \item Controller.
    \item Listener.
    \item Timer.
    \item Assertion.
    \item Cấu hình.
\end{itemize}

\par Một test plan được lưu trong một file XML với phần mở rộng là \texttt{jmx}. Nội dung/thành phần của một test plan có thể được thêm/bớt/chỉnh sửa trên giao diện đồ họa của \jmeter{} hoặc thông qua việc chỉnh sửa file \texttt{*.jmx}.

\section{Thread group}

\par Thread group là thành phần bắt buộc phải có trong một test plan, đồng thời cũng là thành phần đầu tiên hoạt động khi một test plan được thực thi.

\par Thread group quản lý các luồng mà \jmeter{} sẽ sử dụng để thực hiện kiểm thử. Các luồng mà thread group quản lý được coi là sự giả lập người dùng/request, các luồng này hoàn toàn độc lập với nhau.

\FloatBarrier{}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.3]{thread-group.png}
    \caption{Các thuộc tính của một thread group}
    {\label{fig:thread-group}}
\end{figure}
\FloatBarrier{}

\par Như trong hình~\ref{fig:thread-group}, một thread group có các thuộc tính sau:
\begin{itemize}
    \item Number of threads ($n$): Đây là số lượng luồng mà \jmeter{} sẽ tạo và thực thi khi chạy.
    \item Ramp-up period ($t$): Thời lượng mà \jmeter{} dùng để khởi động toàn bộ số lượng luồng đã chỉ định. Chẳng hạn, nếu có $n$ luồng được tạo, còn ramp-up period là $t$ giây thì mỗi luồng sẽ bắt đầu $t/n$ giây sau khi luồng trước đó đã bắt đầu. Với cơ chế như vậy, nếu số lượng luồng là rất lớn thì ramp-up period cũng cần phải đủ lớn để tránh quá tải.
    \item Loop count ($\ell$): Sau mỗi $n/t$ giây, $\ell$ luồng sẽ chạy.
\end{itemize}

\par Ngoài ra, \jmeter{} cho phép chọn thời gian sống (duration), thời gian trễ khởi động (startup delay) của một luồng.

\section{Controller}

\par Trong \jmeter{}, controller là thành phần quyết định quá trình xử lý của một test plan, và có hai loại controller như dưới đây.

\subsection{Sampler}

\par Sampler yêu cầu \jmeter{} gửi request đến server. Chẳng hạn, để \jmeter{} gửi một HTTP request, ta cần một HTTP request sampler. Nói chung, với các giao thức/ứng dụng/dịch vụ khác nhau, có một sampler tương ứng để tạo request với giao thức/ứng dụng/dịch vụ đó.

\par Mục đích của việc sử dụng \jmeter{} là kiểm tra hiệu năng của giao thức/ứng dụng/dịch vụ $-$ do đó việc tạo request là điều phải xảy ra khi thực thi một test plan. Nói cách khác, trong một test plan, phải có ít nhất một sampler.

\par Dưới đây liệt kê một số sampler (còn có các sampler khác) có trong \jmeter{}:

\begin{itemize}[itemsep=0pt]
    \item \textbf{HTTP request}
        \par Sampler này cho phép gửi HTTP/HTTPS request đến server, thiết lập các thuộc tính của một request như method, parameter, body, file (upload) \ldots
        \par Một HTTP request sampler có thể gửi request đến một SOAP, REST web service. Hơn thế nữa, sampler này còn cho phép gửi GraphQL HTTP request.
    \item \textbf{JDBC request}
        \par JDBC request sampler gửi truy vấn SQL đến một cơ sở dữ liệu. Cần cung cấp Driver class và cấu hình JDBC để sử dụng sampler này.
    \item \textbf{Java object request}
        \par Sampler này cho phép điều khiển một class được implement interface

        \begin{quotation}
            \texttt{org.apache.jmeter.protocol.java.sampler.JavaSamplerClient}
        \end{quotation}
    \item \textbf{JUnit request}
        \par Với sampler này, \jmeter{} có thể chạy các JUnit test. Để làm được điều này, ta thực hiện các việc sau:
        \begin{enumerate}[itemsep=0pt,itemindent=1cm,label = Bước \arabic*.]
            \item Biên dịch các file chứa các test case thành những file \texttt{*.jar}
            \item Đặt các file \texttt{*.jar} vừa biên dịch vào thư mục \texttt{\jmeterhome{}/lib/junit/}
            \item Thêm JUnit request sampler vào test plan. JUnit request sampler sẽ nhận ra các class JUnit test và các method được gắn annotate \texttt{@Test}.
        \end{enumerate}
        \par Ở thời điểm viết báo cáo này, \jmeter{} chưa chính thức hỗ trợ Junit 5, mà chỉ đến JUnit 3 và 4.
    \item \textbf{Mail request}
        \par Mail request có thể được chia làm hai loại: đọc mail và gửi mail.
        \par Sampler để đọc mail là \textit{Mail Reader Sampler}. Sampler này có thể sử dụng giao thức POP3 (S) hoặc IMAP (S).
        \par Sampler để gửi mail là \textit{SMTP Sampler}. Sampler này sử dụng giao thức SMTP (S).
    \item \textbf{OS process request}
        \par Sampler này được dùng để thực thi các lệnh trên máy cài \jmeter{}. Sampler này sử dụng được trên cả Windows, Linux và Mac, mặc dù cơ chế phân tích cú pháp lệnh trên shell của các hệ điều hành này khác nhau.
\end{itemize}

\subsection{Logic controller}

\par Khác với sampler, một logic controller là thành phần không bắt buộc có trong một test plan. Nhưng logic controller quyết định thứ tự xử lý của các sampler. Logic controller chứa các sampler và còn có thể chứa các logic controller khác.

\par Dưới đây là một số controller đại diện trong \jmeter{}, tên gọi của những controller này đã cho thấy chúng hoạt động thế nào:

\begin{itemize}[itemsep=0pt]
    \item \textbf{Simple controller}
        \par Chức năng duy nhất của \textbf{Simple controller} lưu lại kết quả chạy của test plan vào một file của thư mục hiện tại (thư mục mà ở đó khởi động \jmeter{}).
    \item \textbf{Loop controller}
        \par Như tên gọi, controller này sẽ lặp lại các request.
        \par Thuộc tính duy nhất của loop controller là loop count. Thuộc tính này kết hợp với loop count của thread group $-$ tức là khi thực thi test plan, trong test plan này có một loop controller, số request được gửi sẽ là
        \[
            \text{number of requests} = \text{loop count of thread group} \times \text{loop count of loop controller}
        \]
    \item \textbf{Once only controller}
        \par Controller này chỉ cho phép request bên trong nó chạy một lần.
    \item \textbf{While controller}
        \par Controller này cần được cung cấp thuộc tính \texttt{Condition} $-$ đây là một giá trị boolean hoặc một biểu thức sẽ trả về giá trị boolean. Giá trị/biểu thức được cung cấp cho \texttt{Condition} có thể sử dụng biến và hàm của \jmeter{}.
        \par Khi chạy test plan, các thành phần của \textbf{While controller} sẽ chạy đến khi \texttt{Condition} có giá trị \texttt{false}.
        \par Nếu \texttt{Condition} bị bỏ trống hoặc có giá trị \texttt{LAST}, vòng lặp sẽ dừng lại khi sample cuối cùng trong \texttt{While controller} fail.
    \item \textbf{ForEach controller}
        \par \textbf{ForEach controller} duyệt qua một tập hợp các biến. Các biến này có cùng \textit{prefix} và được theo sau bởi số thứ tự (bắt đầu từ 1). Ví dụ:
        \begin{quotation}
            \texttt{inputVar\_1}, \texttt{inputVar\_2}, \texttt{inputVar\_3}, \texttt{inputVar\_4}
        \end{quotation}
        \par Nếu biến có giá trị \texttt{null}, sampler trong \textbf{ForEach Controller} sẽ không chạy.
        \par Mỗi lần duyệt, các sampler trong \textbf{ForEach controller} chạy thêm một lần.
    \item \textbf{If controller}
        \par Controller này cũng có một thuộc tính \texttt{Condition}, tuy nhiên giá trị/biểu thức được cung cấp cho thuộc tính này được tính toán bằng \textbf{JavaScript}.
        \par Nếu \texttt{Condition} \texttt{true}, các thành phần trong \textbf{If controller} sẽ chạy. Ngược lại, chúng sẽ bị bỏ qua.
    \item \textbf{Runtime controller}
        \par \textbf{Runtime controller} kiểm soát thời gian chạy của các thành phần bên trong nó. Thuộc tính quy định điều này là \texttt{Runtime} (tính bằng giây). Đến khi thời gian đã chạy của các thành phần trong \textbf{Runtime controller} vượt quá giá trị của \texttt{Runtime} (giây), chúng sẽ dừng lại.
    \item \textbf{Interleave controller}
    \item \textbf{Switch controller}
    \item \textbf{Module controller}
    \item \textbf{Include controller}
\end{itemize}

\section{Listener}

\section{Assertion}

\section{Timer}

\section{Các thành phần khác}

\subsection{Cấu hình}
\subsection{Tiền xử lý}
\subsection{Hậu xử lý}

\section{Cách hoạt động}

\chapter{Một số tính năng}

\section{Kiểm tra hiệu năng}

\subsection{Ứng dụng Web}

\subsection{JDBC}

\subsection{Java Message Service}

\subsection{REST}

\section{Tạo báo cáo}

\section{Khả năng mở rộng}

\section{Khả năng tích hợp với các công cụ khác}

\end{document}
